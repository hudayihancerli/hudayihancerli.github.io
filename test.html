<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oyun Tarzı Harita Taşıma</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body { margin:0; padding:0; height:100%; overflow:hidden; font-family:'Montserrat',sans-serif; background:#121212; }
#home { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; color:#fff; }
#statusText { font-size:2rem; font-weight:700; margin-bottom:20px; }
#clickableCircle { width:140px; height:140px; border-radius:50%; background:#ff3b3b; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; cursor:pointer; transition:transform .2s; font-size:1.2rem; }
#clickableCircle:hover { transform:scale(1.1); }
#mapWrap { display:none; width:100vw; height:100vh; position:relative; }
#map { width:100%; height:100%; position:relative; z-index:1; }
#hud { position:absolute; top:10px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); color:#fff; padding:8px 12px; border-radius:12px; z-index:999; font-weight:700; text-align:center;}
</style>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<div id="home">
  <div id="statusText">Şu anda buradasınız.</div>
  <div id="clickableCircle">Başlat</div>
</div>

<div id="mapWrap">
  <div id="hud">Taşıdığın: <span id="holding">Yok</span></div>
  <div id="map"></div>
</div>

<script>
const startBtn = document.getElementById('clickableCircle');
const home = document.getElementById('home');
const mapWrap = document.getElementById('mapWrap');
const hudHolding = document.getElementById('holding');

let map, playerMarker, holding = null;
let keys = {w:false,s:false,a:false,d:false};
const PLAYER_SPEED = 0.0009;
const PICKUP_RADIUS = 0.04;
const ITEM_RADIUS = 0.03;

let geoData = [
  {id:"item1",type:"Star",color:"gold",coords:[41.037,28.996]},
  {id:"item2",type:"Heart",color:"red",coords:[41.035,28.998]},
  {id:"item3",type:"Diamond",color:"blue",coords:[40.744,29.950]},
  {id:"item4",type:"Circle",color:"purple",coords:[40.748,29.952]}
];

startBtn.addEventListener('click', ()=>{
  home.style.display = 'none';
  mapWrap.style.display = 'block';
  initMap();
});

function initMap(){
 
    map = L.map('map', {
  zoom: 12,               // sabit zoom
  minZoom: 12,             // sabit zoom
  maxZoom: 12,             // sabit zoom
  zoomControl: false,      // zoom butonları kapalı
  dragging: true,          // haritayı sürükleyebilirsin
  scrollWheelZoom: false,  // scroll ile zoom yok
  doubleClickZoom: false,  // çift tık zoom yok
  boxZoom: false,
  touchZoom: false,
  keyboard: true
}).setView([41.015137,28.979530], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);


  playerMarker = L.circleMarker([41.015137,28.979530],{radius:16,color:'red',fillColor:'red',fillOpacity:1}).addTo(map);

  geoData.forEach(f=>{
    while(geoData.some(other=>other.id!==f.id && dist(f.coords[0],f.coords[1],other.coords[0],other.coords[1])<ITEM_RADIUS)){
      f.coords[0] += (Math.random()-0.5)*ITEM_RADIUS;
      f.coords[1] += (Math.random()-0.5)*ITEM_RADIUS;
    }
    f.marker = L.circleMarker(f.coords,{radius:12,color:f.color,fillColor:f.color,fillOpacity:0.9}).addTo(map)
              .bindTooltip(f.type,{permanent:true,direction:'top'});
  });

  requestAnimationFrame(gameLoop);
}

document.body.addEventListener('keydown', e=>{
  switch(e.code){
    case 'KeyW': case 'ArrowUp': keys.w=true; break;
    case 'KeyS': case 'ArrowDown': keys.s=true; break;
    case 'KeyA': case 'ArrowLeft': keys.a=true; break;
    case 'KeyD': case 'ArrowRight': keys.d=true; break;
    case 'KeyQ': // al
      if(!holding){
        for(let f of geoData){
          if(dist(player.lat,player.lng,f.coords[0],f.coords[1])<PICKUP_RADIUS){
            holding = f;
            hudHolding.textContent = f.type;
            f.marker.setStyle({radius:16,opacity:0.7});
            break;
          }
        }
      }
      break;
    case 'KeyE': // bırak
      if(holding){
        holding.marker.setStyle({radius:12, opacity:1});
        holding = null;
        hudHolding.textContent = 'Yok';
        saveData();
      }
      break;
  }
});

document.body.addEventListener('keyup', e=>{
  switch(e.code){
    case 'KeyW': case 'ArrowUp': keys.w=false; break;
    case 'KeyS': case 'ArrowDown': keys.s=false; break;
    case 'KeyA': case 'ArrowLeft': keys.a=false; break;
    case 'KeyD': case 'ArrowRight': keys.d=false; break;
  }
});

let player = {lat:41.015137,lng:28.979530};

function gameLoop(){
  if(keys.w) player.lat += PLAYER_SPEED;
  if(keys.s) player.lat -= PLAYER_SPEED;
  if(keys.a) player.lng -= PLAYER_SPEED;
  if(keys.d) player.lng += PLAYER_SPEED;

  playerMarker.setLatLng([player.lat, player.lng]);
  map.setView([player.lat, player.lng]);

  if(holding){
    let cur = holding.marker.getLatLng();
    let nx = cur.lat + (player.lat - cur.lat)*0.3;
    let ny = cur.lng + (player.lng - cur.lng)*0.3;
    holding.marker.setLatLng([nx, ny]);
    holding.coords = [nx, ny];
  }

  requestAnimationFrame(gameLoop);
}

function dist(lat1,lng1,lat2,lng2){ return Math.hypot(lat1-lat2, lng1-lng2); }

function saveData(){
  try{
    let safeData = geoData.map(f=>({
      id:f.id,type:f.type,color:f.color,
      coords:f.coords
    }));
    localStorage.setItem('geoItems',JSON.stringify(safeData));
  }catch(e){ console.warn('LocalStorage kaydedilemedi.',e); }
}
</script>
</body>
</html>
